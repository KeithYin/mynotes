
# 计算广告
## pv 视角：
> 目前计算广告系统就是这么实现的
* pv来到服务器
* 召回所该user相关的广告 （召回）
* 根据cpm对广告进行排序
* 向用户展示广告
* 用户是否点击该广告（如果点击，则归因到此次eshow）
	* 点击了
		* 该收钱了。收益&成本 都归因该次点击
		* 是否转化。如果转化，归因到此次点击
	* 没点击
		* 没后序了
		* 
* 点击 & 转化 落日志。模型开始根据日志进行训练。

## 广告主视角

* 我是广告主，投广告，有预算
* 我想提高广告投放的roi，所有最好是在合适的时间（RTB系统竞争少的时候），投放给合适的人（能提升我roi的）

# 红包营销

## pv 视角

* pv来到服务器。这里的pv不是一般的page view。
* 召回该用户相关的所有营销任务（有时候为了同一个目的，会配置多个营销任务）
* 选择一个营销任务发给用户
	* 用户转化了
		* 如果用券了，收钱。如果没有用券，不收钱。
		* 转化如何归因？成本如何归因？
	* 用户没转化
		* 没后序了

* 如果这次没有发营销任务给用户
	* 用户转化了
		* 用了之前发的券，收钱。如果没有用券，不收钱
		* 转化如何归因？成本如何归因？
	* 用户没转化 
		* 没有后序了
* 营销任务发送日志 & 转化日志 & 用券日志。模型开始进行训练


# RTB
> 出价和计费不一样，计费方式一般是GSP/VCG

> 出价方式：展现，点击，转化，直接给预算（适用于广告主也不知道如何）

> 计费方式：展现，点击，转化

> 拍卖机制：一堆广告，哪个广告应该竞得该条pv


* CPM: 展现出价，展现计费
	* 广告主视角：朴素的按照pv出价，**pv价值一视同仁**。
	* 广告平台视角：一个pv过来，召回的广告按照cpm排序，给该用户展示，展示就收费。按照GSP/VCG收费
* CPC：点击出价，点击计费
	* 广告主视角：朴素的按照click出价，**click价值一视同仁**。
	* 广告平台视角：一个pv过来，召回的广告预估ctr，根据ctr预估cpm，按照cpm排序，挑top的进行展示。如果点击，按照点击计费（GSP/VCG）
* OCPM：点击出价，展现计费
	* 广告主视角：点击/转化/预算 出价，**pv的价值由广告系统决定**
	* 广告平台视角：一个pv过来，召回的广告预估ctr，根据ctr预估cpm，按照cpm排序，挑top展示。然后计费
* OCPC：转化出价，点击计费
	* 广告主视角：按照转化/预算出价，**点击的价值由广告系统决定**
	* 广告平台视角：一个pv过来，召回的广告预估ctr & cvr，根据ctr * cvr * cvr_bid 预估cpm，按照cpm排序，挑top展示。如果点击，则计费
* CPA：转化出价，转化计费。A为action，可以根据action进行出价
	* 广告主视角：按照转化出价，**转化的价值一视同仁**
	* 广告平台视角：一个pv过来，召回的广告预估 ctr & cvr，根据 ctr * cvr * cvr_bid 预估 cpm，按照cpm排序，挑top展示。如果转化，则计费
* OCPA：ltv出价，转化计费 
* CPLTV：ltv出价，ltv计费
* BCB：budget constrained bidding. 
	* 广告视角：只给出预算，钱怎么花都行
	* 广告平台视角：确定该广告的计费策略（展现/点击/转化）。然后将预算分配到（展现/点击/转化）。然后按照上述方法求解？

**无论上面什么样的产品形式，广告系统总是要为该广告出一个cpm价格的，该价格决定该广告是否竞得该流量。**

如果想提高广告主ROI，广告平台应该怎么做
* 从pv对该广告的价值考虑，如果价值高，就提高出价，如果价值低，就出价低。最终转成统一的cpm去竞价。

如果想提高用户体验：
* 出ctr高的广告
* 出使得用户的时常高的广告

如果想提高平台收益：
* 保证cpm不降低。如何保证cpm不降低呢？

从优化广告主ROI角度来看技术。

* CPM -> OCPM：广告主投了CPM广告，但是广告主的ROI是点击。可以根据pv的质量来优化cpm出价，来提高广告主ROI。🤔️：既然ROI是click，为啥不直接投CPC
* CPC -> OCPC: 广告主投了CPC广告，但是广告主的ROI是点击。可以根据点击的质量来优化cpc出价，来提高广告主ROI。🤔️：既然ROI是convert，为啥不直接投cpa


# oCPC广告

* pv来到服务器
* 召回：系统召回所有对该pv有竞价意向的广告
* 广告来判断该pv的优劣：如果pv的易转化，那么cvr结果就很高。根据cvr来调整该广告的click-bid。
	* cvr 的高低就能体现出广告 竞价的欲望高低了。
* 广告平台判断广告的平台收益：如果广告易点击，那么 ctr 就会很高，相对应的 cpm 就会很高。
	* ctr的高低 间接体现 平台展示你的欲望
	* cpm的高低 体现 平台展示你的欲望
* 广告平台根据cpm的排序，挑top来进行展现。以此来保证广告平台的收益。

## 存在的问题

* 如果广告主的预算早早花完，那么即使后面有更优质的流量，那么也拿不住。只能看着眼馋
	* 难道这就是 预算控制要解决的问题？
	* 预算控制万一 捡了芝麻丢了西瓜 呢？
	* 这个问题是真实存在的吗？还是仅仅是YY一下，思考一个例子🤔
* 如果转化收费控制不住怎么办？
	* 对于成本约束的解决方式是：后验统计真实转新成本，使用 PID 控制算法调整 系数
	* 在 cvr 之前✖️一个系数，点击出价回变成 $coef * cvr * cvrBid$，用来降低广告的整体 竞价欲望。这样之后 cvr 非常优秀的广告 才会竞得 pv。这样能够使得 转化成本降下来。这种方法也存在一个问题，如果✖️的过低，根本就没展现了，所以也不会降真实 转化成本了。

## 存在的模型

* cvr 模型：点击-转新率
	
	* 越准越能表现 pv 的点击质量。只要质量预估的准：竞价欲望就能更精确的表达出来。
* ctr 模型：eshow-转新率
	* 表达用户体验
	
	
# 红包营销

> 基本业务：给用户发业务相关通用红包。
>
> 触发方式：1）圈人，2）在线行为触发
>
> 触达方式：1）短信，2）push，3）站内的一些通知手段

由于一个用户可能会经历 多种触发方式，所以系统可以有两种选择：

1. 不考虑 触发方式之间的互斥，只要触发，就发红包。
   1. 优点
      1. 系统并不需要判断历史领取的红包信息，系统实现起来更简单
   2. 缺点
      1. 模型训练样本构建的话就是每次决策，那么样本的label怎么打呢？ie：如何转化归因，成本归因
2. 考虑触发方式之间的互斥，触发之后，如果之前有红包，就只是提醒，并不发红包。
   1. 优点
      1. 模型训练的样本也是每次决策，但是该决策仅是面额决策。归因仅是归因面额决策那里就ok。
   2. 缺点
      1. 线上会有部分判断是否有已领红包的逻辑。但是这逻辑应该也不难吧



转化归因问题：

1. 用户转化链路上可能会收到多个红包，那么这个转化应该归因到哪个红包上呢？归因到什么粒度上呢？
   1. 粒度：面额，触发方式，触达方式
   2. 一个比较简单的思路就是：能控制啥，就归因到啥？



如果模型介入的，很容易考虑到我们需要一个 转化率模型，一个转化成本模型。

当决策量为 coupon amount时，有以下几种建模方式:

1. 因变量：user。决策量：coupon amount
2. 因变量：user, trigger method。决策量：coupon amount
3. 因变量：user, trigger method,  touch method。决策量：coupon amount



如果因变量考虑 

1. 因变量：user，决策量：coupon amount, trigger method, touch method
2. 因变量：user, trigger method, 决策量：coupon amount, touch method
3. 

