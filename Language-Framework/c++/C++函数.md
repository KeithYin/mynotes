# C++函数



* 关于C++函数默认参数需要注意的

  * 需要在声明是指定默认参数，且在定义时不用说明

  ```c++
  void add(int i, int j=1);

  void add(int i, int j){ //如果在定义的时候也写上int j=1的话，会报错。
    return i+j;
  }
  ```

* C++不支持关键字参数调用

  * 用了python之后老是感觉c++也可以关键字调用，但是实际上是不可以的

  ```c++
  add(i = 1, j = 2); //这样是错误的
  ```

## 函数指针



```c++
// 定义：func 是一个函数指针，指向一个 参数列表为空，返回值为void 的函数
void (*func)();


// printf 是一个函数指针，等价与 &printf，在需要的地方，c++会将函数名转成指针。
void printf(){
  a++;
}

int main(){
  void (*fp)();
  fp = printf;
  (*fp)(); // 调用。
}
```



## 函数调用

当编译器为函数调用产生代码时，执行了以下步骤：

* 如果有返回值，
  * 就将接收返回值的对象的地址压栈。
  * 如果没有接收返回值的对象，就创建一个临时对象，将其地址压栈
* 将函数的参数从右向左压栈。
* 然后执行汇编的CALL指令。CALL指令会将程序代码中的函数调用指令的地址压栈
* 将函数中的局部变量压栈
* 返回：汇编代码中的`ret`指令负责函数调用返回，会将`CALL`指令压栈的地址取出放入 `IP`寄存器。



## 复制构造函数的调用

```c++
A a = generateA();
# 从汇编的角度来看，就是右边的表达式最后 CALL A的复制构造函数，然后move给a。
```



# 函数返回值

|              | 返回值类型是 值                      | 返回值类型为 引用                    |
| ------------ | ------------------------------------ | ------------------------------------ |
| 使用值来接   | 会调用复制构造函数给搞到调用者的栈上 | 会调用复制构造函数给搞到调用者的栈上 |
| 使用引用来接 | 会引用一个左值, 可能是会报错的哦!!!  | 调用者上的就直接引用了.              |
| 不接         | 调用者栈上会有一个临时对象           | 调用者栈上会有一个临时指针?          |

